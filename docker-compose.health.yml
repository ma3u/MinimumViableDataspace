#
#  Copyright (c) 2025 Health Dataspace Demo - EHR2EDC
#
#  This program and the accompanying materials are made available under the
#  terms of the Apache License, Version 2.0 which is available at
#  https://www.apache.org/licenses/LICENSE-2.0
#
#  SPDX-License-Identifier: Apache-2.0
#

version: '3.8'

services:
  # Health Dataspace Frontend (EHR2EDC)
  health-frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: health-frontend
    ports:
      - "3000:80"
    depends_on:
      - ehr-backend
    networks:
      - health-network
    restart: unless-stopped

  # EHR Backend Mock Service (Rheinland Universit√§tsklinikum data)
  ehr-backend:
    build:
      context: ./backend-mock
      dockerfile: Dockerfile
    container_name: ehr-backend
    ports:
      - "3001:3001"
    environment:
      - PORT=3001
    networks:
      - health-network
    restart: unless-stopped

  # HealthDCAT-AP Editor (Interoperability Test Bed SHACL Validator)
  healthdcatap-editor:
    image: isaitb/shacl-validator:latest
    container_name: healthdcatap-editor
    ports:
      - "8082:8080"
    networks:
      - health-network
    restart: unless-stopped

networks:
  health-network:
    driver: bridge

# Note: This docker-compose is for the Health/EHR2EDC demo components.
# The MVD infrastructure (EDC connectors, IdentityHubs, etc.) should be 
# started separately using the IntelliJ run configs or Kubernetes deployment.
#
# To use with IntelliJ deployment:
#   1. Start NGINX for issuer DID
#   2. Start the 'dataspace' compound run config in IntelliJ
#   3. Run ./seed.sh
#   4. Run EHR_BACKEND_URL=http://host.docker.internal:3001 ./seed-health.sh
#   5. docker-compose -f docker-compose.health.yml up --build
#   6. Open http://localhost:3000
#   7. HealthDCAT-AP Editor available at http://localhost:8082
#
# For standalone development (frontend only):
#   cd frontend && npm install && npm run dev
